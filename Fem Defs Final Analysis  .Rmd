---
title: "FemDef Final Analysis"
author: "Sarah Van Dyk"
date: "2024-07-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Read in Data

```{r}
femDef <- read.csv("femDefClean5.csv")

missingFemDef <- read.csv("missingFemDef.csv")

```
##Load all Packages
```{r}
library(tidyverse)
library(stargazer)
library(fastDummies)
library(margins)
library(extrafont)
library(reshape2)
```


#Visualize Missing Data to test for MAR (Figures in Online Appendix)

#Using Dataset with Missing Data to Identity Where NEI is
```{r}

missingFemDef$typology <- missingFemDef$FD.typology..CEO..Partner...Bottom..Manager..Associate...Victim...None..NEI

#Clean two cases of unclear coding
missingFemDef$typology <- ifelse(missingFemDef$typology == "NEI/ Victim", "NEI", missingFemDef$typology)


missingFemDef$typology <- ifelse(missingFemDef$typology == "", "NEI", missingFemDef$typology)


missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "Victim",0, -999)

missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "NEI/ Victim ", -999,missingFemDef$typologyClean )

missingFemDef$typologyName <- ifelse(missingFemDef$typology == "Victim", "1. Victim", NA)

missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "Manager",1, missingFemDef$typologyClean)

missingFemDef$typologyName <- ifelse(missingFemDef$typology == "Manager", "1. Manager", missingFemDef$typologyName)

missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "Bottom",2, missingFemDef$typologyClean)

missingFemDef$typologyName <- ifelse(missingFemDef$typology == "Bottom", "2. Bottom", missingFemDef$typologyName)

missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "Associate",3, missingFemDef$typologyClean)

missingFemDef$typologyName <- ifelse(missingFemDef$typology == "Associate", "3. Associate", missingFemDef$typologyName)

missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "Partner",4, missingFemDef$typologyClean)

missingFemDef$typologyName <- ifelse(missingFemDef$typology == "Partner", "4. Partner", missingFemDef$typologyName)


missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "NEI",-999, missingFemDef$typologyClean)


missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "Other",-888, missingFemDef$typologyClean)


missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "None",-888, missingFemDef$typologyClean)


missingFemDef$typologyClean <- ifelse(missingFemDef$typology == "CEO",5, missingFemDef$typologyClean)

missingFemDef$typologyName <- ifelse(missingFemDef$typology == "CEO", "5. CEO", missingFemDef$typologyName)


```


#Online Appendix Figure 1
#First Test - Age
```{r}

missingFemDef$typologyName <- ifelse(missingFemDef$typologyClean < 0, "NEI", missingFemDef$typologyName)



a <- ggplot(data=missingFemDef, aes(x = as.factor(typologyName), y = arrest_age))+
geom_point(color = "#1957CD")+
theme_minimal()+
ylim(0,80)+
labs(x = "Typology", y = "Age")+
ggtitle("Age of Missing Data Randomly Distributed")

a + theme(
  plot.title = element_text(face = "bold", size = 12),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  text = element_text(family = "Times New Roman")
)


femDef$isNaTypo <- ifelse(femDef$typologyClean < 0, 1, 0 )


mod1 <- lm(isNaTypo ~ arrest_age, data = femDef)
stargazer(mod1, type = "text")

##Conclusion - based on both visual analysis & OLS modeling, age at arrest is not a signficant predictor of missing data, indicating, on this axis, data is missing at random 

```

#Online Appendix Figure 2: Second Test - Race
```{r}


missingFemDef$raceNew <- ifelse(missingFemDef$race == "Native American", "Other", missingFemDef$race)

missingFemDef$raceNew <- ifelse(missingFemDef$race == "Indian", "Other", missingFemDef$raceNew)

missingFemDef$raceNew <- ifelse(missingFemDef$race == "", "Unknown", missingFemDef$raceNew)


femDef$RaceNew3 <-ifelse(femDef$raceNew == "NA", 'Unknown', femDef$raceNew1)

femDef2 <- missingFemDef %>%
  group_by(typologyName, raceNew) %>%
  summarise(
    count = n()
  ) %>%
  group_by(typologyName) %>%
  mutate(
  `Percent of Typology Group` = count / sum(count) * 100
  )


a <- ggplot(femDef2, aes(x= typologyName, y = raceNew, size = `Percent of Typology Group`))+
  geom_point(color = "#0F347B")+
  labs(x = "", y = "")+
  theme_minimal()


a + theme(
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)

femDef2$isNaTypo <- ifelse(femDef2$typologyName == "NEI", 1, 0)

mod1 <- glm(isNaTypo ~ raceNew, data = femDef2, family = "binomial")
stargazer(mod1, type = "text")

##Conclusion - based on both visual analysis & logit modeling, race is not a signficant predictor of missing data, indicating, on this axis, data is missing at random 
```


#Figure 2: Recruitment Plot
```{r}

recruitDta <- femDef %>%
                group_by(typologyName) %>%
                summarise(
                defNum = n(),
                totalAdmin = sum(recruit_binary),
                percent = totalAdmin/defNum*100
                )

recruitDta$percent2 <- round(recruitDta$percent)
table(recruitDta$percent2)
                


loadfonts(device = "pdf")

font_import(pattern = "Times New Roman")
loadfonts(device = "pdf")

a <- ggplot(data = recruitDta, aes(x = typologyName, y = percent)) +
  geom_bar(stat = "identity", fill = "#0F347B") +
  ggtitle("") +
  ylab("Percent of Defendants") +
  scale_x_discrete(labels = c("Manager\n n = 55", "Bottom\n n = 159", "Associate\n n = 37", "Partner\n n = 109", "CEO\n n = 39")) +
  ylim(0,80)+
  xlab("") +
  geom_text(aes(label = percent2), family="Times", vjust = -0.5) +
  theme_minimal()

a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)

```

#Figure 3: Create Stacked Bar Chart of Administrative Acitvities
```{r}
 dta<-(femDef)%>%
    group_by(typologyName) %>%
    summarise(
              Train=sum(train_binary, na.rm = TRUE),
              Enforce=sum(enforce_binary, na.rm = TRUE),
              `Organize Buyer`=sum(organize_binary, na.rm = TRUE),
              `Handle Money` = sum(money_binary, na.rm = TRUE)
              )

  
dta$total<-  dta$Train + dta$Enforce + dta$`Organize Buyer` +
            dta$`Handle Money`

dta2<-subset(dta, select=c("typologyName", "total", "Train",
                           "Enforce", "Organize Buyer", "Handle Money"))


dta3 <-melt(dta, id.vars = c("typologyName", "total"), variable.name = "adminType", value.name = "number_of_defs")

View(dta3)

dta4 <-  (dta3)%>%
    group_by(adminType, typologyName)%>%
    summarise (percent = number_of_defs/total)
    
view(dta4)


a <- ggplot(data = (dta4), aes(fill = adminType, y = percent, x = factor(typologyName))) + 
  geom_bar(position = "stack", stat = "identity")+ 
  scale_fill_manual(values=(c("#1957CD", "#0F347B", "#46ADE3", "#1895A7","#A5E3ED", "#44CEA5" )))+
  ggtitle("") +
  theme_minimal() +
  xlab("") +
  ylab("Total Occurrences of Administrative Method")+
  labs(fill = "")+
  scale_x_discrete(labels = c("Manager\n n = 55", "Bottom\n n = 159", "Associate\n n = 37",  "Partner\n n = 109", "5. CEO\n n = 39")) 

a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)
```


#Difference in Means Test - Victim Binary
```{r}
table(femDef$victimDummy)
t.test(femDef$victimDummy)
```
#Difference in Means - Enforce and Admin
```{r}
victims <- subset(femDef, femDef$victimDummy==0)
nvictims <- subset(femDef, femDef$victimDummy==1)

pairwise_results <- pairwise.t.test(victims$enforce_binary, victims$typologyName)

pairwise_results2 <- pairwise.t.test(nvictims$enforce_binary, nvictims$typologyName)

# Print the pairwise t-test results
print(pairwise_results)
print(pairwise_results2)

#Predicted Probabilities of Enforcing

pairwise_results3 <- pairwise.t.test(victims$money_binary, victims$typologyName)

# Print the pairwise t-test results
print(pairwise_results3)

mod <- lm(enforce_binary ~ typologyName, data=femDef)
summary(mod)

table(femDef$enforce_binary, femDef$typologyName)


#Percent of Enforce per Typology (in order manager, bottom, associate, partner, CEO)

2/54
18/(141+18)
2/37
20/109
12/39
```



#Figure 4: Create Histogram of Typology
```{r}

a <- ggplot(data=femDef, aes(x=as.factor(typologyName)))+
  geom_histogram(stat="count", aes(fill=as.factor(typologyName)))+
  scale_x_discrete(labels=c("Manager", "Bottom", "Associate", "Partner", "CEO"))+
  scale_fill_manual(values=(c( "#1957CD", "#0F347B", "#46ADE3", "#1895A7","#A5E3ED")))+
  theme_minimal()+
  theme(legend.position="none")+
  ggtitle("")+
  xlab("")+
  ylab("Total Number of Women Charged")+
  geom_text(stat="count", aes(label=..count..), family="Times", vjust=-0.5)+
 scale_y_continuous(limits = c(0, 175), breaks = seq(0, 175, by = 25))

a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)
```
#Difference of Means Test of Victims v. Offenders
```{r}
t.test(femDef$victimDummy, mu = .5)
```

#Differences in Enforcement Across All
```{r}
mod <- lm(enforce_binary ~ typologyName, data=femDef)
summary(mod)

femDef$bottom_relevel <- fct_relevel(femDef$typologyName, "2. Bottom")
mod <- lm(enforce_binary ~ bottom_relevel, data=femDef)
summary(mod)

```

#Figure 5: Create Chart of Administrative Activities Across Typology
```{r}

femDef$total<-  femDef$train_binary + femDef$enforce_binary + femDef$organize_binary +
            femDef$money_binary 

dta <- femDef %>%
  group_by(typologyName) %>%
  summarise(
  avg = mean(total)
)

view(dta)

dta$avg2 <- round(dta$avg, 2)

a <- ggplot(data = dta, aes(x = typologyName, y = avg))+
  geom_bar(stat = "identity", fill = "#46ADE3")+
  ggtitle("")+
  ylab("Average number of Administrative Activites")+
  geom_text(aes(label = avg2), family="Times", vjust = -0.5) +
  scale_x_discrete(labels = c("Manager", "Bottom", "Associate", "Partner", "CEO"))+ 
  xlab("")+
    theme_minimal()
  
  

a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)

```

#OLS Model Recruitment + Administration & Typology
```{r}
table(femDef$recruit_binary)

mod2 <- lm(recruit_binary ~ typologyName, data = femDef)
stargazer(mod2, type = "text")


mod1 <- lm(enforce_binary ~ typologyName, data = femDef)
stargazer(mod1, type = "text")

mod1 <- lm(money_binary ~ typologyName, data = femDef)
stargazer(mod1, type = "text")

mod1 <- lm(organize_binary ~ typologyName, data = femDef)
stargazer(mod1, type = "text")


mod1 <- lm(total ~ typologyName, data = femDef)
stargazer(mod1, type = "text")

```



#Figure 6: Create chart of trafficking type across typology
```{r}

#Create Count of Percent
my_data_summary <- femDef %>%
  group_by(typologyName, type_of_sex1) %>%
  summarise(Count = n())

count <- my_data_summary$Count


# Calculate percentagses within each typologyName group
my_data_summary <- na.omit(my_data_summary) %>%
  group_by(typologyName) %>%
  mutate(Percent = Count / sum(Count) * 100)

table(my_data_summary$Percent)
table(my_data_summary$typologyName)

# Plot the stacked bar chart
a <- ggplot(data = na.omit(my_data_summary), aes(fill = type_of_sex1, y = Percent, x = typologyName)) + 
  geom_bar(position = "stack", stat = "identity")+ 
  scale_fill_manual(values=(c("#1957CD", "#0F347B", "#46ADE3", "#1895A7" )))+
  ggtitle("") +
  theme_minimal() +
  xlab("") +
  labs(fill = "Type of \nTrafficking")+
  scale_x_discrete(labels = c("Manager\n n = 55", "Bottom\n n = 159", "Associate\n n = 37", "Partner\n n = 109", "CEO\n n = 39")) + 
  ylab("Percentage of Whole")  

a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)
```

#Model the relationship between age & typology

#Age with 40+ as a default comparison catagory
```{r}


femDef <- femDef %>%
  mutate(ageGroup = sapply(arrest_age, categorize_age))

table(femDef$ageGroup)

femDef$age4_ <- fct_relevel(femDef$ageGroup, "40+")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy <- glm(victimDummy ~ age4_, data = femDef, family=binomial)
summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ age4_,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ age4_,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ age4_,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ age4_,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ age4_,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")



```

##Age with 35-39 as default

```{r}

femDef$age3.5_ <- fct_relevel(femDef$ageGroup, "35-39")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy <- glm(victimDummy ~ age3.5_, data = femDef, family=binomial)
summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ age3.5_,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ age3.5_,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ age3.5_,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ age3.5_,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ age3.5_,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")


```

#Age with 30-34 as default

```{r}
femDef$age3_ <- fct_relevel(femDef$ageGroup, "30-34")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy <- glm(victimDummy ~ age3_, data = femDef, family=binomial)
summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ age3_,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ age3_,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ age3_,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ age3_,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ age3_,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")


```

##Age model with 24-29 as default

```{r}

femDef$age2.5_ <- fct_relevel(femDef$ageGroup, "25-29")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy <- glm(victimDummy ~ age2.5_, data = femDef, family=binomial)
summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ age2.5_,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ age2.5_,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ age2.5_,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ age2.5_,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ age2.5_,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")

```

##Age model from 20-24

```{r}

femDef$age2_ <- fct_relevel(femDef$ageGroup, "20-24")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy <- glm(victimDummy ~ age2_, data = femDef, family=binomial)
summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ age2_,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ age2_,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ age2_,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ age2_,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ age2_,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")

```

#Figure 7a & 7b Create Age Plots - Box Plot & Average
```{r}

averageAge <- femDef %>%
  group_by(typologyName) %>%
  summarise(
  averageAge1 = mean(as.integer(arrest_age), na.rm = TRUE)
  )


a <- ggplot(data = averageAge, aes(x = typologyName, y = averageAge1))+
geom_bar(stat= "identity", aes(fill=as.factor(typologyName)))+
ylim(0,40)+
scale_fill_manual(values=(c( "#1957CD", "#0F347B", "#46ADE3", "#1895A7","#A5E3ED")))+
ylab("Age at Arrest")+
xlab("")+
scale_x_discrete(labels = c("Manager\nn = 55", "Bottom\nn = 159", "Associate\nn = 37", "Partner\nn = 109", "CEO\nn = 39"))+
geom_text(aes(label = round(averageAge1, 1)), family="Times", vjust = -0.5) +
theme_minimal()+
theme(legend.position="none")

a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)




b <- ggplot(data=femDef, aes(x=arrest_age, y=typologyName)) +
    geom_boxplot() +
    scale_y_discrete(labels = c("Manager\nn = 55", "Bottom\nn = 159", "Associate\nn = 37", "Partner\nn = 109", "CEO\nn = 39"))+
    ylab("")+
    xlab("Age at Arrest")+
    theme_minimal()

b + theme(
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)


```

#Model effect of typology on race
```{r}

#Race Effect on Typology Using White as Default
femDef$raceNew <- ifelse(femDef$raceNew == "Unknown", NA, femDef$raceNew)

femDef$raceNew <- ifelse(femDef$raceNew == "Other", NA, femDef$raceNew)

table(femDef$raceNew)

femDef$raceNewW <- fct_relevel(femDef$raceNew, "White")

dummy_typology1 <- dummy_cols(femDef, select_columns = "typologyName")


modRaceDummy<- glm(victimDummy ~ raceNewW,  data = femDef, family = binomial())

summary(modRaceDummy)

modRaceMana<- lm(`typologyName_1. Manager` ~ raceNewW,  data = dummy_typology1)

summary(modRaceMana)


modRacebottom<- lm(`typologyName_2. Bottom` ~ raceNewW,  data = dummy_typology1)

summary(modRacebottom)


modRaceAss<- lm(`typologyName_3. Associate` ~ raceNewW,  data = dummy_typology1)

summary(modRaceAss)


modRacePart<- lm(`typologyName_4. Partner` ~ raceNewW,  data = dummy_typology1)

summary(modRacePart)


modRaceCEO<- lm(`typologyName_5. CEO` ~ raceNewW,  data = dummy_typology1)

summary(modRaceCEO)

stargazer(modRaceDummy, modRaceMana, modRacebottom, modRaceAss, modRacePart = "html", out = "race.htm")

getwd()

```

#Race Effect on Typology Using Black as Default

```{r}
#Race Effect on Typology Using Black as Default

femDef$raceNewB <- fct_relevel(femDef$raceNew, "Black")

dummy_typology2 <- dummy_cols(femDef, select_columns = "typologyName")


modRaceDummy<- glm(victimDummy ~ raceNewB,  data = femDef, family = binomial())

summary(modRaceDummy)

modRaceMana<- lm(`typologyName_1. Manager` ~ raceNewB,  data = dummy_typology2)

summary(modRaceMana)


modRacebottom<- lm(`typologyName_2. Bottom` ~ raceNewB,  data = dummy_typology2)

summary(modRacebottom)


modRaceAss<- lm(`typologyName_3. Associate` ~ raceNewB,  data = dummy_typology2)

summary(modRaceAss)


modRacePart<- lm(`typologyName_4. Partner` ~ raceNewB,  data = dummy_typology2)

summary(modRacePart)


modRaceCEO<- lm(`typologyName_5. CEO` ~ raceNewB,  data = dummy_typology2)

summary(modRaceCEO)



stargazer(modRaceDummy, modRaceMana, modRacebottom, modRaceAss, modRacePart, type = "html")

?stargazer
stargazer(modRaceCEO, type = "text")
```

#Race Effect on Typology Using Asian as Default

```{r}

#Race Effect on Typology Using Asian as Default

femDef$raceNewA <- fct_relevel(femDef$raceNew, "Asian")

dummy_typology3 <- dummy_cols(femDef, select_columns = "typologyName")

modRaceDummy<- glm(victimDummy ~ raceNewA,  data = femDef, family = binomial())

summary(modRaceDummy)

modRaceMana<- lm(`typologyName_1. Manager` ~ raceNewA,  data = dummy_typology3)

summary(modRaceMana)


modRacebottom<- lm(`typologyName_2. Bottom` ~ raceNewA,  data = dummy_typology3)

summary(modRacebottom)


modRaceAss<- lm(`typologyName_3. Associate` ~ raceNewA,  data = dummy_typology3)

summary(modRaceAss)


modRacePart<- lm(`typologyName_4. Partner` ~ raceNewA,  data = dummy_typology3)

summary(modRacePart)


modRaceCEO<- lm(`typologyName_5. CEO` ~ raceNewA,  data = dummy_typology3)

summary(modRaceCEO)


stargazer(modRaceDummy, modRaceMana, modRacebottom, modRaceAss, modRacePart, type = "text")
stargazer(modRaceCEO, type = "text")
```

#Race Effect on Typology Using Hispanic as Default

```{r}

#Race Effect on Typology Using Hispanic as Default

femDef$raceNewH <- fct_relevel(femDef$raceNew, "Hispanic")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modRaceDummy<- glm(victimDummy ~ raceNewH,  data = femDef, family = binomial())

summary(modRaceDummy)


modRaceMana<- lm(`typologyName_1. Manager` ~ raceNewH,  data = dummy_typology4)

summary(modRaceMana)


modRacebottom<- lm(`typologyName_2. Bottom` ~ raceNewH,  data = dummy_typology4)

summary(modRacebottom)


modRaceAss<- lm(`typologyName_3. Associate` ~ raceNewH,  data = dummy_typology4)

summary(modRaceAss)


modRacePart<- lm(`typologyName_4. Partner` ~ raceNewH,  data = dummy_typology4)

summary(modRacePart)


modRaceCEO<- lm(`typologyName_5. CEO` ~ raceNewH,  data = dummy_typology4)

summary(modRaceCEO)

stargazer(modRaceDummy, modRaceMana, modRacebottom, modRaceAss, modRacePart, type = "text")
stargazer(modRaceCEO, type = "text")
```


#Figure 8: Create Racial Distribution Plot 
```{r}


femDef$raceNew <- ifelse(femDef$raceNew == "Other", NA, femDef$raceNew)

table(femDef$raceNew)

#Create Count of Percent
my_data_summary <- femDef %>%
  group_by(typologyName, raceNew) %>%
  summarise(Count = n())



# Calculate percentages within each typologyName group
my_data_summary <- na.omit(my_data_summary) %>%
  group_by(typologyName) %>%
  mutate(Percent = Count / sum(Count) * 100)


table(my_data_summary$Percent)

##Create Consolidated Race Variable

# Plot the stacked bar chart
a <- ggplot(data = (my_data_summary), aes(fill = raceNew, y = Percent, x = typologyName)) + 
  geom_bar(position = "stack", stat = "identity") +
  scale_fill_manual(values=(c("#1957CD", "#0F347B", "#46ADE3", "#1895A7","#A5E3ED")))+
  ggtitle("") +
  theme_minimal() +
  xlab("") +
  labs(fill = "Racial \nClassification")+
  scale_x_discrete(labels = c("Manager\nn = 55", "Bottom\nn = 159", "Associate\nn = 37", "Partner\nn = 109", "CEO\nn = 39")) +
  ylab("Percentage of Typology")  

a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)

```

#Model effect of foreign victims on typology
```{r}

femDef$percent_foreign_victims <- (femDef$number_victims_foreign / femDef$number_of_defendants.y) 
femDef$percent_foreign_victims <- as.numeric(femDef$percent_foreign_victims)
table(femDef$percent_foreign_victims)
femDef$forgienDummy <- ifelse(femDef$percent_foreign_victims > 0 , 1, 0)

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy<- glm(victimDummy ~ forgienDummy,  data = femDef, family = binomial())

summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~  forgienDummy,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~  forgienDummy,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~  forgienDummy,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~  forgienDummy,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~  forgienDummy,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")
```
#OLS Test - Race & Foreign Victim
```{r}

library(nnet)
mod1 <- multinom(raceNewW ~forgienDummy, data=femDef)
stargazer(mod1, type = "text")
names(femDef)
```


#Figure 9: Plot foreign victim average across typology 
```{r}

percentForg <- femDef %>%
  group_by(typologyName) %>%
  summarise(
  countForg = sum(forgNat, na.rm=TRUE),
  countTotal = sum(number_victims, na.rm = TRUE),
  percentForg1 = countForg/countTotal*100
)


view(percentForg)


a <- ggplot(data = percentForg, aes(x = typologyName, y = percentForg1))+
geom_bar(stat= "identity", aes(fill=as.factor(typologyName)))+
ylim(0,3)+
scale_fill_manual(values=(c( "#1957CD", "#0F347B", "#46ADE3", "#1895A7","#A5E3ED")))+
ylab("Percent of Foreign National Victims")+
xlab("")+
scale_x_discrete(labels = c("Manager\nn = 55", "Bottom\nn = 159", "Associate\nn = 37", "Partner\nn = 109", "CEO\nn = 39"))+
geom_text(aes(label = round(percentForg1, 1)), family="Times", vjust = -0.5) +
theme_minimal()+
theme(legend.position="none")

a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)

```

#Model effect of victim age on typological distribution

#Minor victim only as reference catagory
```{r}

femDef$minorM<- fct_relevel(femDef$minorNice, "Minor Victims Only")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy<- glm(victimDummy ~ minorM,  data = femDef, family = binomial())

summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~  minorM,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~  minorM,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~  minorM,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~  minorM,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~  minorM,  data = dummy_typology4)





stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")
```

##Minor and Adult as reference catagory

```{r}
##Minor and Adult

femDef$minorB<- fct_relevel(femDef$minorNice, "Minor & Adult Victims")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy<- glm(victimDummy ~ minorB,  data = femDef, family = binomial())

summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~  minorB,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~  minorB,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~  minorB,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~  minorB,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~  minorB,  data = dummy_typology4)

summary(modCEO)

library(stargazer)

stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")

```

#Adult as reference catagory

```{r}


femDef$minorA<- fct_relevel(femDef$minorNice, "Adult Victims Only")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy<- glm(victimDummy ~ minorA,  data = femDef, family = binomial())

summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~  minorA,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~  minorA,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~  minorA,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~  minorA,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~  minorA,  data = dummy_typology4)

summary(modCEO)

library(stargazer)

stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")


```

#Figure 10 - Create Age of Victim Chart
```{r}

victimCount <- femDef %>%
  group_by(typologyName, minorNice) %>%
  summarise(Count = n())

view(victimCount)

victimCount <- na.omit(victimCount) %>%
  group_by(typologyName) %>%
  mutate(Percent = Count / sum(Count) * 100)

a <- ggplot(data = na.omit(victimCount), aes(fill = minorNice, y = Percent, x = (typologyName))) + 
  geom_bar(position = "stack", stat = "identity")+ 
  scale_fill_manual(values=(c("#1957CD", "#0F347B", "#46ADE3", "#1895A7","#A5E3ED", "#44CEA5" )))+
  ggtitle("") +
  theme_minimal() +
  xlab("") +
  ylab("Percent Of Whole")+
  labs(fill = "")+
  scale_x_discrete(labels = c("Manager\n n = 55", "Bottom\n n = 159", "Associate\n n = 37", "Partner\n n = 109", "CEO\n n = 39")) 


a + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)


```

#Model effect of traffcking location on typology

#Trafficking Location with Online as Default

```{r}
##Trafficking Location with Online as Default
femDef$traffTypeO<- fct_relevel(femDef$type_of_sex1, "Online Solicitation")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy<- glm(victimDummy ~ traffTypeO,  data = femDef, family = binomial())

summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ traffTypeO,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ traffTypeO,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ traffTypeO,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ traffTypeO,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ traffTypeO,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")



```

##Trafficking Location with Online as Default

```{r}
##Trafficking Location with Online as Default
femDef$traffTypeB<- fct_relevel(femDef$type_of_sex1, "Brothel")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy<- glm(victimDummy ~ traffTypeB,  data = femDef, family = binomial())

summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ traffTypeB,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ traffTypeB,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ traffTypeB,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ traffTypeB,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ traffTypeB,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")

```

##Trafficking Location with Online as Default

```{r}

##Trafficking Location with Online as Default
femDef$traffTypeOS<- fct_relevel(femDef$type_of_sex1, "Outdoor Solicitation")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy<- glm(victimDummy ~ traffTypeOS,  data = femDef, family = binomial())

summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ traffTypeOS,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ traffTypeOS,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ traffTypeOS,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ traffTypeOS,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ traffTypeOS,  data = dummy_typology4)

summary(modCEO)


stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")

```

##Trafficking Location with Other as Default

```{r}

##Trafficking Location with Other as Default
femDef$traffTypeOR<- fct_relevel(femDef$type_of_sex1, "Other")

dummy_typology4 <- dummy_cols(femDef, select_columns = "typologyName")

modDummy<- glm(victimDummy ~ traffTypeOR,  data = femDef, family = binomial())

summary(modDummy)


modMana<- lm(`typologyName_1. Manager` ~ traffTypeOR,  data = dummy_typology4)

summary(modMana)


modbottom<- lm(`typologyName_2. Bottom` ~ traffTypeOR,  data = dummy_typology4)

summary(modbottom)


modAss<- lm(`typologyName_3. Associate` ~ traffTypeOR,  data = dummy_typology4)

summary(modAss)


modPart<- lm(`typologyName_4. Partner` ~ traffTypeOR,  data = dummy_typology4)

summary(modPart)


modCEO<- lm(`typologyName_5. CEO` ~ traffTypeOR,  data = dummy_typology4)

summary(modCEO)



stargazer(modDummy, modMana, modbottom , modAss, modPart , modCEO, type = "text")
```






#Defendant Charateristics Model
```{r}

mod1 <- glm(victimDummy ~  arrest_age+ raceNew1  , data = femDef, family = binomial())
summary(mod1)
stargazer(mod1, type = "text", 
dep.var.labels = ("Victim-Offender Dictomus Variable"),
    covariate.labels = c("Age at Arrest",
                          "Black",
                          "White"
))

```


#Victim Charateristics Model
```{r}

mod2 <- glm(victimDummy ~  (minorNice + forgNat), family = binomial(), data = femDef)
summary(mod2)

stargazer(mod2, type = "text", 
  dep.var.labels = ("Victim-Offender Dictomus Variable"),
    covariate.labels = c("Only Adult Victims",
                          "Minor and Adult Victims",
                          "Foreign Victim"
))

```


#Trafficking Location Model
```{r}

mod3 <- glm(victimDummy ~ type_of_sex1, data = femDef, family = binomial())
summary(mod3)

stargazer(mod3, type = "text", 
  dep.var.labels = ("Victim-Offender Dictomus Variable"),
   covariate.labels = c("Online Solicitation",
                        "Other",
                        "Outdoor Solicitation"
))
```


#Fully Specificed Model + Figure 11 + Appendix Plot 4
```{r}
library(stargazer)

mod4 <- glm(victimDummy ~ arrest_age+raceNew1+ minorNice + forgNat + type_of_sex1, data = femDef, family = binomial())

mod4$residuals

summary(mod4, type = "text")


stargazer(mod4,type = "text", 
  dep.var.labels = ("Victim-Offender Dictomus Variable"),
   covariate.labels = c("Age at Arrest",
                        "Black",
                        "White",
                        "Only Adult Victim",
                        "Only Minor Victim",
                        "Foreign National Victim",
                        "Online Solicitation",
                        "Other - Trafficking",
                        "Outdoor Solicitation"
))


par(family = "Times New Roman")
plot(mod4)

#Figure 11: Predicted Probability Model of Age using Fully specified model 

par(family = "Times New Roman")
cplot(mod4, xlab = "Age at Arrest", ylab = "Predicted Likihood of being an Offender")
```


#Without Outliers Specific Model
```{r}

femDef_no <- femDef[-c(2, 145, 187, 293, 110, 228), ]

# Check the table of residuals after removing specific observations
table(femDef_no$Resid)

# Fit the new model (mod5) with the remaining data
mod5 <- glm(victimDummy ~ arrest_age + raceNew1 + minorNice + forgNat + type_of_sex1, data = femDef_no, family = binomial())

# Display the summary of the new model
summary(mod5)


# Display the new model summary using stargazer
stargazer(mod5, type = "text", 
  dep.var.labels = "Victim-Offender Dichotomous Variable",
  covariate.labels = c(
    "Age at Arrest",
    "Black",
    "White",
    "Only Adult Victim",
    "Only Minor Victim",
    "Foreign National Victim",
    "Online Solicitation",
    "Other - Trafficking",
    "Outdoor Solicitation"
  )
)

plot(mod5)


```


#VIM Test
```{r}
library(car)

# Calculating VIF
vif_values <- vif(mod5)
vif_values

# Visualizing the model
plot(mod5, which = 1, main = "Model Fit")

# Visualizing VIF
barplot(vif_values, col = "skyblue", main = "Variance Inflation Factor (VIF)")
```

#Correlation Matrix
```{r}
library(tidyverse)
library(polycor)
library(psych)
library(stargazer)
library(fastDummies)

dta <- subset(femDef, select=  c("arrest_age", "raceNew1", "minorNice", "forgNat", "type_of_sex1"))


dta$raceNew1 <- as.factor(dta$raceNew1)
dta$minorNice <- as.factor(dta$minorNice)
dta$forgNat <- as.factor(dta$forgNat)
dta$type_of_sex1 <- as.factor(dta$type_of_sex1)


# Polychoric correlation for ordinal variables
cor_polychoric <- hetcor(dta, use = "complete.obs", std.error = TRUE, thresholds = TRUE)


# Print the results
print(cor_polychoric$tests)
print(cor_polychoric$std.errors)
print(cor_polychoric$correlations)
print(cor_polychoric)


#Brothel & Age Correlation
dummy_cols(femDef, select_columns = c("type_of_sex1"))

dta <- subset(femDef, select=  c("arrest_age","brothel", "other_sex", "online","outdoor"))

cor_polychoric <- hetcor(dta, use = "complete.obs", std.error = TRUE, thresholds = TRUE)

print(cor_polychoric)

```


#Online Appendix: Figure 3 Create Line Plot if Victun and Offenders over time 
```{r}

femDef$reverseVictim <- ifelse(femDef$victimDummy == 1, 0, 1)


yearBy <- femDef %>%
  group_by(year)%>%
      summarise(total_offenders = sum(victimDummy, na.rm = TRUE),
                total_victims = sum(reverseVictim, na.rm= TRUE))
                
yearByPercent <- na.omit(yearBy) %>%
  reframe(percentVictims = (total_victims / (total_victims + total_offenders)),
            percentOffenders = (total_offenders / (total_victims + total_offenders)),
          year = year  )

view(yearByPercent)

a <- ggplot(data = yearByPercent, aes(x = year)) +
  geom_line(aes(y = percentVictims, colour = "Victims"), linewidth = 1) +
  geom_line(aes(y = percentOffenders, colour = "Offenders"), linewidth = 1) +
  ylab("Percent of Total Defendants") +
  scale_x_continuous(breaks = seq(2000, 2020, by = 5)) +
  scale_color_manual(values = c("Victims" = "#46ADE3","Offenders" = "#A5E3ED")) +
  labs(color = "")+
  theme_minimal()+
  xlab("Year")



a + theme(
      axis.title.x = element_text(face = "bold", size = 12),
      axis.title.y = element_text(face = "bold", size = 12),
      axis.text = element_text(size = 10),
  plot.title = element_text(face = "bold", size = 12),
  text = element_text(family = "Times New Roman")
)

```


#Online Appendix: Summary Statistics Chart
```{r}

##Creating Dummies as Needed
library(gt)
library(tidyverse)

femDef$white <- ifelse(femDef$raceNew == 'White', 1, 0)
femDef$other <- ifelse(femDef$raceNew == 'Other' ,1,0)
femDef$black <- ifelse(femDef$raceNew == 'Black' ,1,0)

table(femDef$minorNice)

femDef$adult_binary <- ifelse(femDef$minorNice == 'Adult Victims Only',1,0)
femDef$adult_minor_binary <- ifelse(femDef$minorNice == 'Minor Victims Only',1,0)
femDef$minor_binary <- ifelse(femDef$minorNice == 'Adult & Minor Victims',1,0)

table(femDef$type_of_sex1)

femDef$brothel <- ifelse(femDef$type_of_sex1 == 'Brothel' ,1,0)
femDef$other_sex <- ifelse(femDef$type_of_sex1 == 'Online Solicitation' ,1,0)
femDef$online <- ifelse(femDef$type_of_sex1 == 'Other' ,1,0)
femDef$outdoor <- ifelse(femDef$type_of_sex1 == 'Outdoor Solicitation' ,1,0)

##Formatting Data

tableFormData <- femDef %>%
  group_by(typologyName) %>%
  summarise(
  countTotal = n(),
  
  paverageAge1 = mean(as.integer(arrest_age), na.rm = TRUE),
  averageAgeRound = round(paverageAge1),
  
  countForg = sum(forgNat, na.rm=TRUE),
  percentForg1 = countForg/countTotal*100,
  rpercetFR = round(percentForg1),
  
  countWhite = sum(white, na.rm = TRUE),
  percentWhite1 = countWhite/countTotal*100,
  rpercetWH = round(percentWhite1),
  
  countBlack = sum(black, na.rm = TRUE),
  percentBlack1 = countBlack/countTotal*100,
  rpercetBL = round(percentBlack1),
  
  countOther = sum(other, na.rm = TRUE),
  percentOther1 = countOther/countTotal*100,
  rpercetOH = round(percentOther1),
  
  countAdult = sum(adult_binary, na.rm = TRUE),
  percentAdult = countAdult/countTotal*100,
  rpercetAD = round(percentAdult),
  
  countMinorAdult = sum(adult_minor_binary, na.rm = TRUE),
  percentMinorAdult = countMinorAdult/countTotal*100,
  rpercetMA = round(percentMinorAdult),
  
  countMinor = sum(minor_binary, na.rm = TRUE),
  percentMinor1 = countMinor/countTotal*100,
  rpercetMN = round(percentMinor1),
  
  countBrothel = sum(brothel, na.rm = TRUE),
  percentBrothel1 = countBrothel/countTotal*100,
  rpercetBR = round(percentBrothel1),
  
  countOtherSex = sum(other_sex, na.rm = TRUE),
  percentOtherSex = countOtherSex/countTotal*100,
  rpercetOS = round(percentOtherSex),
  
  countOnline = sum(online, na.rm = TRUE),
  percentOnline = (countOnline/countTotal*100),
  rpercetON = round(percentOnline),
  
  countOutdoor = sum(outdoor, na.rm = TRUE),
  percentOutdoor = countOutdoor/countTotal*100,
  rpercetOD = round(percentOutdoor)
    
)

view(tableFormData)

tableFormData <- tableFormData %>%
  select(-starts_with("p"))


a <- tableFormData %>%
  gt() %>%
    tab_header(title = "T.R.A.P. Typology Summary Statistics") %>%
    cols_label(typologyName = "Typology", 
            averageAgeRound = "Average Age",
            countForg = "Count Foreign Victims" , 
            countTotal = "Total Def.",
            rpercetFR = "Percent Foregin Victims",
            countWhite = "Count White",
            countBlack = "Count Black",
            rpercetBL = "Percent Black",
            countOther = "Count Other (Race)",
            rpercetOH = "Percent Other (Race)",
            countAdult = "Count Adult Only Victims",
            rpercetAD = "Percent Adult Only Victims",
            countMinor = "Count Minor Only Victims",
            rpercetMN = "Percent Minor Only Victims",
            rpercetWH = "Percent White",
            countMinorAdult = "Count Minor and Adult Victims",
            rpercetMA = "Percent Minor and Adult Victims",
            countBrothel = "Count Brothel-Related Crimes",
            rpercetBR = "Percent Brothel-Related Crimes",
            countOtherSex = "Count Other Crime Location",
            rpercetOS = "Percent Other Crime Location",
            countOnline = "Count Online Crime",
            rpercetON = "Percent Online Crime",
            countOutdoor = "Count Outdoor Crime",
            rpercetOD = "Percent Outdoor Crime"
             )
             



```

#Online Appendix 2 - Descriptive Statistics
```{r}
table(femDef$typology)
mean(femDef$typology)
sd(femDef$typology)

table(femDef$victimDummy)
mean(femDef$victimDummy)
sd(femDef$victimDummy)

age_levels <- c("18-23" = 1, "24-29" = 2, "30-34" = 3, "35-39" = 4, "40+" = 5)
femDef$ageGroup2 <- as.numeric(factor(femDef$ageGroup,
                                     levels = names(age_levels),
                                     labels = age_levels))
table(femDef$ageGroup2)
mean(femDef$ageGroup2, na.rm = TRUE)
sd(femDef$ageGroup2, na.rm = TRUE)


race_levels <- c("Black" = 2, "White" = 1, "Other" = 3)
femDef$raceNew2 <- as.numeric(factor(femDef$raceNew1,
                                     levels = names(race_levels),
                                     labels = race_levels))
table(femDef$raceNew2)
mean(femDef$raceNew2,  na.rm = TRUE)
sd(femDef$raceNew2, na.rm = TRUE)


minor_levels <- c("Minor Victims Only" = 1, "Adult Victims Only" = 2, "Adult & Minor Victims" = 3)
femDef$minorNice1 <- as.numeric(factor(femDef$minorNice,
                                     levels = names(minor_levels),
                                     labels = minor_levels))
table(femDef$minorNice1)
mean(femDef$minorNice1,  na.rm = TRUE)
sd(femDef$minorNice1, na.rm = TRUE)

table(femDef$forgNat)
mean(femDef$forgNat, na.rm = TRUE)
sd(femDef$forgNat, na.rm = TRUE)


sex_levels <- c("Brothel" = 1, "Online Solicitation" = 2, "Outdoor Solicitation" = 3, "Other" = 4)
femDef$type_of_sex2 <- as.numeric(factor(femDef$type_of_sex1,
                                     levels = names(sex_levels),
                                     labels = sex_levels))
table(femDef$type_of_sex2)
mean(femDef$type_of_sex2,  na.rm = TRUE)
sd(femDef$type_of_sex2, na.rm = TRUE)

```

 
#Missing Racial Data - R&R

#Defendant Charateristics Model
```{r}
names(femDef)

table(femDef$raceNew)
table(femDef$raceNew1)
  
femDef$RaceNew3 <-ifelse(is.na(femDef$raceNew1), 'Unknown', femDef$raceNew1)
femDef$RaceNew3 <- fct_relevel(femDef$RaceNew3, "Other")

mod1 <- glm(victimDummy ~  arrest_age+ RaceNew3  , data = femDef, family = binomial())


summary(mod1)
stargazer(mod1, type = "text", 
dep.var.labels = ("Victim-Offender Dictomus Variable"),
    covariate.labels = c("Age at Arrest",
                          "Black",
                         "Unknown",
                          "White"
))


mod4 <- glm(victimDummy ~ arrest_age+RaceNew3+ minorNice + forgNat + type_of_sex1, data = femDef, family = binomial())

mod4$residuals

summary(mod4, type = "text")


stargazer(mod4,type = "text", 
  dep.var.labels = ("Victim-Offender Dictomus Variable"),
   covariate.labels = c("Age at Arrest",
                        "Black",
                        "Unknown",
                        "White",
                        "Only Adult Victim",
                        "Only Minor Victim",
                        "Foreign National Victim",
                        "Online Solicitation",
                        "Other - Trafficking",
                        "Outdoor Solicitation"
))

```



#For Reference - Latent Class Modeling 

```{r}
#This was not pursued because it is not inline with the level of responsibility in recruitment and administration 

library(poLCA)
arrest_age+RaceNew3+ minorNice + forgNat + type_of_sex1

# Convert specified columns to factors
femDef$raceNew2 <- as.factor(femDef$raceNew1)
femDef$type_of_sex2 <- as.factor(femDef$type_of_sex1)
femDef2$arrest_age <- as.factor(round(femDef2$arrest_age / 10))
femDef2$typology <- as.factor(femDef2$typologyName)
femDef2$victim <- as.factor(femDef2$victimDummy)
femDef$forgNat2 <- as.factor(femDef$forgNat)
femDef$minorNice2 <- as.factor(femDef$minorNice)

names(femDef)
femDef2$victim <- as.factor(femDef2$victimDummy)



femDef2$recruit_binary <- as.factor(femDef2$recruit_binary)
femDef2$trafficker <- as.factor(femDef2$trafficker)
femDef2$prostitution <- as.factor(femDef2$prostitution)

library(tidyverse)
femDef2 <- femDef %>%
   mutate(
    admin = rowSums(across(c(care_binary, train_binary, organize_binary, enforce_binary, money_binary, care_binary)))
  )

femDef2$admin <- (as.integer(femDef2$admin)+1)
 class(femDef2$admin)
 table(femDef2$admin)


femDef2 <- femDef[complete.cases(femDef[, c("raceNew2","type_of_sex2",
                                            "arrest_age", "minorNice2",
                                            "type_of_sex2", "forgNat2")]), ]

femDef2 <- droplevels(femDef2)


# Run the Latent Class Analysis
lca.polca <- poLCA(
  cbind(raceNew2, type_of_sex2, admin, prostitution, recruit_binary, trafficker, arrest_age, forgNat2, minorNice2) ~ 1,
  nclass = 4,
  data = femDef2,   # Use the complete cases dataset
  nrep = 10,
  na.rm = TRUE,
  graphs = TRUE
)

lca.polca4 <- poLCA(
  cbind(  admin, prostitution,recruit_binary, trafficker) ~ 1,
  nclass = 2,
  data = femDef2,   # Use the complete cases dataset
  nrep = 10,
  na.rm = TRUE,
  graphs = TRUE
)

femDef2$typology <- as.factor(femDef2$typology)


lca.polca5 <- poLCA(
  cbind(  admin, prostitution,recruit_binary, trafficker) ~ 1,
  nclass = 5,
  data = femDef2,   # Use the complete cases dataset
  nrep = 10,
  na.rm = TRUE,
  graphs = TRUE
)

library(tidyverse)
lcmodel <- reshape2::melt(lca.polca4$probs, level=4)



zp1 <- ggplot(lcmodel,aes(x = L4, y = value, fill = Var2))
zp1 <- zp1 + geom_bar(stat = "identity", position = "stack")
zp1 <- zp1 + facet_grid(Var1 ~ .) 
zp1 <- zp1 + scale_fill_manual(values = custom_colors)
zp1


table(femDef2$arrest_age)
ggpplot(lca.polca)

custom_colors <- c(
  "#EAB8E4", "#A67BC2", "#5B3F8E", "#8B62A6", "#D1A2D1",
  "#E0A1E9", "#B084C9", "#A36B9A", "#C4B3D1", "#D8A3D1",
  "#CFA1D8", "#6A2C91", "#7F57B8", "#A76DA1", "#D9C6E7",
  "#D8A4E0", "#C493BF", "#9D7FB8", "#7B4C8E", "#A168C9",
  "#B69AD7", "#BF86C9", "#8F5C9A", "#9B7BCE", "#AA88D9"
)

table(femDef2$trafficker)
table(femDef2$prostitution)


femDef2$prostitution <- ifelse(femDef2$typology == "Bottom", 1, femDef$prostitution )
femDef2$prostitution <- (femDef2$prostitution)+1
table(femDef2$prostitution)
```

```


